# 完整工作流程示例

本文档展示如何使用脚本神器插件完成一个完整的空投任务流程。

## 📋 场景描述

**目标**: 批量完成Linera空投任务，包括：
- 访问官网并连接钱包
- 关注Twitter和加入Discord
- 完成测试网交互
- 自动Claim奖励

**规模**: 使用10个浏览器配置文件，批量执行

---

## 🔧 步骤1: 准备工作

### 1.1 配置比特浏览器

1. 在比特浏览器中创建10个配置文件
2. 每个配置文件配置不同的代理和User-Agent
3. 记录每个配置文件的ID（如：`profile_001` 到 `profile_010`）

### 1.2 配置插件

通过API或数据库配置比特浏览器连接：

```bash
# 通过API配置
curl -X POST http://localhost:8080/api/airdrop/configs \
  -H "Content-Type: application/json" \
  -d '{
    "configType": "BITBROWSER",
    "configKey": "api.url",
    "configValue": "http://127.0.0.1:54345",
    "configDesc": "比特浏览器API地址"
  }'
```

---

## 📝 步骤2: 创建任务

### 2.1 通过UI创建

1. 登录WLDOS系统
2. 进入"脚本神器" → "自动化调度器"
3. 点击"创建调度任务"
4. 填写任务信息：
   - **任务名称**: Linera批量空投任务
   - **项目类型**: Linera
   - **脚本类型**: JavaScript
   - **脚本内容**: [见下方脚本]
   - **队列配置**:
     - 并发数: 3
     - 任务间隔: 2秒
     - 错误重试: 3次

### 2.2 通过API创建

```bash
curl -X POST http://localhost:8080/api/airdrop/scheduler/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Linera批量空投任务",
    "projectType": "linera",
    "scriptType": "javascript",
    "scriptContent": "...",
    "profileIds": ["profile_001", "profile_002", ...],
    "queueConfig": {
      "concurrency": 3,
      "taskInterval": 2,
      "errorRetry": 3
    }
  }'
```

---

## 🎬 步骤3: 执行任务

### 3.1 通过UI执行

1. 在任务列表中点击"执行"按钮
2. 系统会自动：
   - 启动浏览器实例
   - 执行附带动作（如Twitter绑定）
   - 执行脚本
   - 记录执行结果

### 3.2 通过API执行

```bash
curl -X POST http://localhost:8080/api/airdrop/scheduler/tasks/{taskId}/execute \
  -H "Content-Type: application/json"
```

---

## 📊 步骤4: 监控执行

### 4.1 查看任务状态

```bash
# 获取任务状态
curl http://localhost:8080/api/airdrop/scheduler/tasks/{taskId}

# 响应示例
{
  "id": "task_001",
  "name": "Linera批量空投任务",
  "status": "RUNNING",
  "completedTasks": 5,
  "failedTasks": 1,
  "totalTasks": 10
}
```

### 4.2 查看执行记录

```bash
# 获取执行记录
curl http://localhost:8080/api/airdrop/execution?taskId={taskId}

# 响应示例
[
  {
    "id": "exec_001",
    "taskId": "task_001",
    "profileId": "profile_001",
    "status": "success",
    "startTime": "2025-12-28T10:00:00",
    "endTime": "2025-12-28T10:05:00",
    "duration": 300000
  },
  ...
]
```

---

## 🔍 步骤5: 查看结果

### 5.1 成功案例

执行成功的任务会显示：
- ✅ 状态: COMPLETED
- ✅ 完成数: 10/10
- ✅ 执行时间: 约5-10分钟

### 5.2 失败处理

如果任务失败：
1. 查看执行记录中的错误信息
2. 检查浏览器实例是否正常
3. 验证脚本语法是否正确
4. 根据错误信息调整配置
5. 重新执行失败的任务

---

## 💡 最佳实践

### 1. 任务配置建议

- **并发数**: 建议3-5个，避免请求过快
- **任务间隔**: 建议2-5秒，模拟人工操作
- **错误重试**: 建议3次，提高成功率

### 2. 脚本编写建议

- 使用 `await page.waitForTimeout()` 增加延迟
- 使用 `try-catch` 处理异常
- 使用 `console.log()` 记录执行过程
- 检查元素是否存在再操作

### 3. 浏览器配置建议

- 使用不同的代理IP
- 配置不同的User-Agent
- 使用真实的浏览器指纹
- 定期更新配置文件

---

## 🎯 完整脚本示例

### JavaScript脚本（Linera空投）

```javascript
// 完整脚本内容请参考: docs/demo-scripts/javascript-linera.js
```

### 使用模板

如果不想每次都写脚本，可以使用模板：

```bash
# 获取模板列表
curl http://localhost:8080/api/airdrop/templates

# 使用模板创建任务
curl -X POST http://localhost:8080/api/airdrop/scheduler/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Linera任务",
    "templateId": "template_linera_001",
    "profileIds": ["profile_001", ...]
  }'
```

---

## 📞 故障排查

### 问题1: 浏览器启动失败

**原因**: API连接失败或配置文件不存在

**解决**:
1. 检查比特浏览器是否运行
2. 验证API地址和密钥
3. 确认配置文件ID正确

### 问题2: 脚本执行超时

**原因**: 脚本执行时间过长

**解决**:
1. 增加超时时间配置
2. 优化脚本逻辑
3. 减少不必要的等待

### 问题3: 元素找不到

**原因**: 页面结构变化或选择器错误

**解决**:
1. 更新元素选择器
2. 增加等待时间
3. 使用更通用的选择器

---

**文档版本**: v1.0  
**最后更新**: 2025-12-28

