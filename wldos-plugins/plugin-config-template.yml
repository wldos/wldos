# WLDOS 插件配置文件模板 (plugin.yml)
# 此文件定义了插件的所有配置信息，包括基本信息、权限、菜单等
# 
# WLDOS 资源权限体系精髓：
# - 所有资源（菜单和按钮操作）都是 wo_resource 表中的记录
# - 按钮操作是菜单资源的子资源，通过 parent_id 关联
# - 没有独立的权限概念，只有资源编码（resource_code）
# - 前端获取的是资源树结构，根据用户角色过滤
# 
# WLDOS 资源权限体系精髓之二：
# - 系统管理菜单：adminMenu，按钮：adminButton
# - 用户侧菜单：menu，按钮：button
# - 只读资源（GET）：默认所有用户可访问，不设置角色关联
# - 操作资源（POST/修改）：必须显式关联有操作权限的角色
# - 配置字段：资源编码用 code，插件编码用 code
# 
# 数据库脚本管理：
# - 插件的数据库脚本必须放在 src/main/database/ 目录下
# - 系统会自动检测并执行相应的脚本
# - 配置文件不再需要 database 配置节
# - 脚本命名约定：create-tables.sql, drop-tables.sql, init-data.sql, upgrade-*.sql

# ==================== 基本信息 ====================
code: your-plugin-code                    # 插件唯一标识符（必需）
name: 你的插件名称                        # 插件显示名称（必需）
version: 1.0.0                            # 插件版本号（必需）
description: 插件功能描述                  # 插件描述（必需）
author: 插件作者                          # 插件作者（必需）
mainClass: com.wldos.plugin.your.YourPlugin  # 插件主类（必需）
autoStart: false                          # 是否自动启动（可选，默认false）

# ==================== 前端依赖声明 ====================
# 插件前端依赖声明（用于运行时依赖管理）
# 
# 核心原则（与后端一致）：
# - 如果主应用已提供依赖（如 antd、React），插件使用主应用的（避免重复和冲突）
# - 如果主应用未提供，插件自行维护和加载（类似后端插件自带某些依赖）
#
# WLDOS 前端框架提供的常见依赖：
# - React, ReactDOM（必须提供）
# - antd（通常提供）
# - 其他依赖需要根据实际情况判断
#
# dependencies:
#   frontend:
#     - name: antd                    # 依赖名称（npm 包名）
#       version: "^5.0.0"             # 版本要求（可选）
#       globalVar: antd                # 全局变量名（可选，默认使用 getGlobalVarName）
#       expectFromMainApp: true        # 是否期望主应用提供（默认 true）
#       required: true                 # 是否必需（默认 true）
#       components:                    # 需要的组件列表（仅用于某些库如 antd）
#         - Button
#         - Card
#         - Table
#     - name: lodash
#       version: "^4.17.0"
#       globalVar: _
#       expectFromMainApp: false       # 不期望主应用提供，插件自行维护
#       required: true
#     - name: echarts
#       expectFromMainApp: false       # 不期望主应用提供，插件自行维护
#       required: true
#
# 说明：
# 1. expectFromMainApp=true：优先使用主应用的依赖，缺失时自动加载
# 2. expectFromMainApp=false：插件自行维护和加载（主应用即使有也不使用）
# 3. 如果 expectFromMainApp=true 且主应用未提供，系统会自动加载
# 4. 如果 expectFromMainApp=false，系统不检查主应用，直接加载插件的依赖

# ==================== 菜单资源配置 ====================
# 所有资源（菜单和按钮操作）都在这里定义
# 按钮操作作为菜单的 children，通过 parent_id 关联
# 系统管理侧：adminMenu/adminButton，用户侧：menu/button
# 
# 插件菜单路径约定：
# - 用户侧菜单：/pluginCode/xxx
# - 子菜单：/pluginCode/xxx/.../
# - 管理侧菜单：/admin/pluginCode/xxx
# - 管理侧子菜单：/admin/pluginCode/xxx/.../
#
# 菜单配置规范（2025-11-02 更新）：
# 1. 顶级菜单（第一层菜单）：
#    - 如果有子菜单：可以不配置 component（作为占位菜单，仅用于模块占用和权限控制）
#    - 如果没有子菜单：必须配置 component（作为首页菜单，直接显示组件）
#    - 顶级菜单路径：作为子菜单路径的前缀（如：/admin/plugin-code）
# 2. 子菜单（第二层及以下）：
#    - 必须配置 component（除非是按钮类型资源）
#    - 按钮类型资源（resourceType 包含 button）：不需要 component 字段
#    - 子菜单路径：必须以顶级菜单路径为前缀（如：/admin/plugin-code/home）
# 3. 菜单层级：支持最多3级（包含顶级菜单），即：顶级菜单 -> 子菜单 -> 子子菜单
# 4. 路径规则：后端不允许路径重复，顶级菜单和子菜单不能使用相同的路径
#    示例（正确）：
#      顶级菜单: /admin/plugin-code
#      子菜单:   /admin/plugin-code/home, /admin/plugin-code/list
#    示例（错误）：
#      顶级菜单: /admin/plugin-code/home
#      子菜单:   /admin/plugin-code/home  ❌ 路径重复
menus:
  - code: your-main-menu                   # 资源编码（权限字）
    name: 主菜单                           # 菜单名称
    path: /admin/your                      # 请求路由（遵循插件路径约定，作为子菜单路径的前缀）
    icon: YourIcon                         # 菜单图标
    # 注意：顶级菜单有子菜单时，可以不配置 component（作为占位菜单）
    sort: 100                              # 排序值
    resourceType: admin_plugin_menu        # 资源类型：admin_plugin_menu(管理侧插件菜单) 或 plugin_menu(用户侧插件菜单)
    children:                              # 子菜单或按钮操作
      # 第一个子菜单作为首页
      - code: your-home                    # 子菜单
        name: 首页
        path: /admin/your/home             # 子菜单路径必须以顶级菜单路径为前缀
        component: YourMainComponent      # 子菜单必须配置 component
        sort: 0
        resourceType: admin_plugin_menu    # 资源类型
      
      - code: your-sub-menu                # 子菜单
        name: 子菜单
        path: /admin/your/sub
        icon: SubIcon
        component: YourSubComponent       # 子菜单必须配置 component
        sort: 1
        resourceType: admin_plugin_menu   # 资源类型
        children:                          # 子菜单下的按钮操作
          - code: your:module:view         # 按钮操作（资源编码）
            name: 查看模块
            path: /admin/your/module/view  # API 操作路由
            sort: 1
            resourceType: admin_plugin_button  # 资源类型：admin_plugin_button(管理侧) 或 plugin_button(用户侧)
            method: GET                    # 请求方法：GET(只读，默认所有用户可访问) 或 POST/DELETE(操作，需显式关联角色)
            # 注意：按钮类型不需要 component 字段
          - code: your:module:create
            name: 创建记录
            path: /admin/your/module/create
            sort: 2
            resourceType: admin_plugin_button
            method: POST                   # 操作类型，需要显式关联角色
          - code: your:module:edit
            name: 编辑记录
            path: /admin/your/module/edit
            sort: 3
            resourceType: admin_plugin_button
            method: POST                   # 操作类型，需要显式关联角色
          - code: your:module:delete
            name: 删除记录
            path: /admin/your/module/delete
            sort: 4
            resourceType: admin_plugin_button
            method: DELETE                 # 操作类型，需要显式关联角色

# ==================== 钩子配置 ====================
hooks:
  - extName: your.plugin.init              # 扩展点名称
    type: INVOKE                           # 钩子类型：HANDLER 或 INVOKE
    priority: 10                           # 优先级（1-100）
    description: 插件初始化
    method: initPlugin                     # 处理方法名
  - extName: your.plugin.cleanup
    type: INVOKE
    priority: 10
    description: 插件清理
    method: cleanupPlugin

# ==================== 可选配置 ====================
category: 工具                             # 插件分类：工具、管理、监控、集成、安全、其他
icon:                                     # 插件图标配置
  small: icon-16.png                      # 小图标（16x16）
  medium: icon-32.png                     # 中图标（32x32）
  large: icon-64.png                      # 大图标（64x64）
tags: [标签1, 标签2]                       # 插件标签
screenshots: [screenshot1.png]            # 插件截图
banner: banner.png                        # 插件横幅图片
documentation: https://docs.example.com   # 插件文档URL
changelog: https://changelog.example.com  # 变更日志URL

# ==================== 字段格式说明 ====================
# code: 只能包含小写字母、数字、连字符，且必须以字母开头和结尾
# version: 格式为 x.y.z 或 x.y.z-标识符
# mainClass: 必须是有效的Java类名
# menus.code: 资源编码，只能包含小写字母、数字、连字符、冒号，且以字母开头
# menus.path: 请求路由，必须遵循插件路径约定
#   - 用户侧：/pluginCode/xxx 或 /pluginCode/xxx/.../
#   - 管理侧：/admin/pluginCode/xxx 或 /admin/pluginCode/xxx/.../
# menus.component: 前端组件路径，验证规则（2025-11-01 更新）：
#   - 顶级菜单有子菜单：可以不配置 component（作为占位菜单）
#   - 顶级菜单无子菜单：必须配置 component（作为首页菜单）
#   - 子菜单：必须配置 component（按钮类型除外）
#   - 按钮类型：不需要 component 字段
# children.path: API 操作路由，应以 /admin/ 开头
# children.method: 请求方法，GET(只读) 或 POST/DELETE(操作)

# ==================== 资源类型说明 ====================
# 系统管理侧资源：
#   - adminMenu: 系统管理菜单，有 component 字段，path 是请求路由
#   - adminButton: 系统管理按钮，没有 component 字段，path 是 API 操作路由
#   - admin_plugin_menu: 管理侧插件菜单，component 字段验证规则：
#     * 顶级菜单有子菜单：可以不配置 component（占位菜单）
#     * 顶级菜单无子菜单：必须配置 component（首页菜单）
#     * 子菜单：必须配置 component，path 是 /admin/pluginCode/xxx 格式
#   - admin_plugin_button: 管理侧插件按钮，不需要 component 字段
# 
# 用户侧资源：
#   - menu: 用户侧菜单，有 component 字段，path 是请求路由
#   - button: 用户侧按钮，没有 component 字段，path 是 API 操作路由
#   - plugin_menu: 用户侧插件菜单，component 字段验证规则：
#     * 顶级菜单有子菜单：可以不配置 component（占位菜单）
#     * 顶级菜单无子菜单：必须配置 component（首页菜单）
#     * 子菜单：必须配置 component，path 是 /pluginCode/xxx 格式
#   - plugin_button: 用户侧插件按钮，不需要 component 字段

# ==================== 权限约束规则 ====================
# 只读资源（method: GET）：
#   - 默认所有用户可访问
#   - 不设置角色关联
#   - 主要用于查看、列表等操作
# 
# 操作资源（method: POST/DELETE）：
#   - 必须显式关联有操作权限的角色
#   - 根据资源编码命名规则自动分配角色
#   - 主要用于创建、编辑、删除等操作

# ==================== 权限分配规则 ====================
# 根据资源编码命名规则自动分配角色：
# - :view/:read → 所有角色（guest, user, admins, tadmin, admin）
# - :create/:add → 注册用户及以上（user, admins, tadmin, admin）
# - :edit/:update → 管理员及以上（admins, tadmin, admin）
# - :delete/:remove → 租户管理员及以上（tadmin, admin）
# - :admin/:manage → 超级管理员（admin）

# ==================== 数据库脚本管理 ====================
# 插件的数据库脚本必须放在 src/main/database/ 目录下，系统会自动检测并执行：
# 
# 必需脚本（如果插件需要数据库）：
# - create-tables.sql: 创建表脚本
# - drop-tables.sql: 删除表脚本
# 
# 可选脚本：
# - init-data.sql: 初始化数据脚本
# - upgrade-{version}.sql: 升级脚本（如 upgrade-1.1.0.sql）
# - uninstall.sql: 卸载脚本
# 
# 脚本执行时机：
# - 安装时：执行 create-tables.sql 和 init-data.sql
# - 升级时：执行对应的 upgrade-{version}.sql
# - 卸载时：先执行 drop-tables.sql（如果存在），然后自动清理所有相关表
# 
# 重要说明：
# 1. 配置文件不再需要 database 配置节
# 2. 系统会自动检测 database/ 目录中的脚本文件
# 3. 表名会自动添加 plugin_{pluginCode}_ 前缀
# 4. 支持 {t:logicName} 通配符进行动态表名解析

# ==================== 常见错误 ====================
# ❌ 错误：pluginCode: your-plugin-id
# ✅ 正确：code: your-plugin-code
# 
# ❌ 错误：pluginName: 你的插件名称
# ✅ 正确：name: 你的插件名称
# 
# ❌ 错误：pluginVersion: 1.0.0
# ✅ 正确：version: 1.0.0
# 
# ❌ 错误：id: your-menu-id
# ✅ 正确：code: your-menu-code
# 
# ❌ 错误：resourceType: plugin_menu（用户侧插件菜单）
# ✅ 正确：resourceType: adminMenu、menu、plugin_menu 或 admin_plugin_menu
# 
# ❌ 错误：缺少 method 字段
# ✅ 正确：method: GET(只读) 或 POST/DELETE(操作)
# 
# ❌ 错误：在配置文件中添加 database 配置节
# ✅ 正确：将数据库脚本放在 src/main/database/ 目录下，系统自动检测
#
# ==================== component 字段常见错误（2025-11-01 更新）====================
# ❌ 错误：顶级菜单有子菜单但配置了 component
# ✅ 正确：顶级菜单有子菜单时，可以不配置 component（作为占位菜单）
#
# ❌ 错误：顶级菜单无子菜单但缺少 component
# ✅ 正确：顶级菜单无子菜单时，必须配置 component（作为首页菜单）
#
# ❌ 错误：子菜单缺少 component（且不是按钮类型）
# ✅ 正确：子菜单必须配置 component（按钮类型除外）
#
# ❌ 错误：按钮类型配置了 component
# ✅ 正确：按钮类型不需要 component 字段
